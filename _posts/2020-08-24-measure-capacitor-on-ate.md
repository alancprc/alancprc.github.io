---
layout:     post
title:      measure capacitor on ATE
categories: ate
---

* 目录
{:toc}

ATE(Automatic Test Equipment)，主要用于各种芯片的量产测试。

笔者最近在工作中碰到几次需要对测试电容的情况，用到了几种不同类型的板卡，通过这篇文章进行一个总结。

## 说明
电容既可以在充电时测量电容值，也可以在放电时测量电容值，因为客户的测试方案中指定了在放电时测量，所以如下测试都先充电到预设电压，在放电时测量电容值。

## 使用VI源+Digitizer
### 原理
```
C = Q / U = ΔQ / ΔU = I * Δt / ΔU
```
通过施加一个固定电流I，并测量在一段时间内的电容电压变化，即可通过以上公式计算出电容值。
### 步骤
1. 使用电压源模式，先Force 0.5V，等待一段时间，确保电容充满。需要注意电源的电流钳制设置，过小的话充电耗时太长。
2. 设置VI源对电容电压进行采样，以采样周期为samplePeriod，采样点数为numSamples
3. 切换VI源为电流源模式，施加一个反向电流（从电容流回到VI源）Idischarge，开始放电。注意需要设置好电压钳位，因为放电到0V之后，VI源会开始对电容进行反向充电，如果不设置电压钳位，反向充电电压过大，有损坏电容的风险。
4. 等待采样完成，或超出一定时间后，切换VI源为电压源模式，Force 0V，恢复电容状态。
5. 从采样数据中选取一段线性区间，计算两个点的电压差ΔU，以及对应的Δt，则电容值为 C = Idischarge * Δt / ΔU
### 特点
测试大电容的情况下，如果VI源的电流能力通常比较大，测试时间会比较短。

## 使用电压源+固定电阻+Digitizer
### 电路图
我们公司有一种板卡，结构大概如下：
```
                            电压测试点
电压源---------电阻---------------------------------- 电容 -- GND
        1KOhm 或 500KOhm        |
                                |
                                Digitizer
```
每个通道都有一个digitizer（当然，内部肯定是公用的），有一个电阻，可以在1KOhm 和 500 KOhm中间切换。
利用这种板卡可以测量电容
### 原理
固定电压时，电容的充放电公式：
```
Vt = V0 + (Ve - V0) * (1-e^(-t/RC))
```
其中，
* `Ve` 是施加的固定电压
* `V0` 是施加`Ve`之前电容两端的电压
* `t` 是从`Ve`施加后经过的时间
* `R` 是电路中的电阻
* `C` 是电容的容值

如果`Ve` 为0V，则上述公式可以简化成
```
Vt = V0 * e^(-t/RC)
```
电容C的值为
```
C = t / (  R  * ln(V0 / Vt) )
```
如果我们能找到一个点，使得 Vt = V0 / e，上述公式可以进一步简化为
```
C = t / R
```
### 步骤
1. 根据电容大小，选择1KOhm或者500KOhm
2. Force 0.5V，等待一段时间，确保电容充满。
2. 设置Digitizer对电容电压进行采样，以采样周期为samplePeriod，采样点数为numSamples
3. Force 0.5V，开始放电
4. 等待采样完成
5. 选取合适的电压区间，比如从 [0.4V, 0.4V * 1/e]，从采样数据中搜索第一个小于0.4V的点A，第一个小于 0.4V * 1/e = 0.147V的点B。点A和点B的间隔为
```
Δt = AB 之间的距离 * samplePeriod
```
则电容值为 C = Δt / R

## 使用Digital Pin(Resistor Load)
## 使用Digital Pin(Current Load)

